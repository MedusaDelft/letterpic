!function(a){a.fn.letterpic=function(b){function r(a){if(a){if(a.colors)return c.fillTypeColor;if(a.gradients)return c.fillTypeGradient;if(a.images)return c.fillTypeImage}return c.fillTypeGradient}function s(a){var b=a.data().userid,c=a.attr("title");c?b||(b=c):c="";var e=l[b];return e||(e={backgroundIdx:d++,text:t(c)},l[b]=e),e}function t(a){var b=a.split(" "),c=b[0].charAt(0).toUpperCase();return b.length>1&&(c+=b[1].charAt(0).toUpperCase()),c}function u(a){return!(!a.complete||"undefined"!=typeof a.naturalWidth&&0===a.naturalWidth)}function v(b){var c=a(b.target);c.off("error",v),w(c)}function w(b){var c;b.is("canvas")?c=b:(c=a("<canvas></canvas>"),a.each(b[0].attributes,function(a,b){c.attr(b.name,b.value)}),b.replaceWith(c));var d=s(c);x(c,d)}function x(a,b){var d=a[0],e=window.devicePixelRatio,f=e*a.width(),g=e*a.height(),h=d.getContext("2d");h.scale(e,e),a.attr("width",f),a.attr("height",g);var i=f*m.fontSize;h.font=i+"px "+m.font,h.textAlign="center",c.drawProviders[m.fill](h,d,b,function(){B(b.text,i,h,f,g)})}function y(a,b,c,d){a.fillStyle=m.colors[c.backgroundIdx%m.colors.length],a.fillRect(0,0,b.width,b.height),d()}function z(a,b,c,d){var e=a.createLinearGradient(0,0,0,b.height),f=m.gradients[c.backgroundIdx%m.gradients.length];e.addColorStop(0,f[0]);for(var g=1/(f.length-1),h=1;h<f.length-1;h++)e.addColorStop(h*g,f[h]);e.addColorStop(1,f[f.length-1]),a.fillStyle=e,a.fillRect(0,0,b.width,b.height),d()}function A(a,b,c,d){var e=new Image;e.onload=function(){a.drawImage(e,0,0,b.width,b.height),a.fillStyle=m.imageOverlayColor,a.fillRect(0,0,b.width,b.height),d()},e.src=m.images[c.backgroundIdx%m.images.length]}function B(a,b,c,d,e){var f=d/2,g=.45*(b+e);m.fontStrokeColor&&(c.shadowColor=m.fontStrokeColor,c.shadowColor="black",c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=3),c.fillStyle=m.fontColor,c.fillText(a,f,g)}var c=this;c.fillTypeColor="color",c.fillTypeGradient="gradient",c.fillTypeImage="image";var d=0,e="Arial",f="#fff",g="#000",h=.45,i=["#F44336","#673AB7","#03A9F4","#4CAF50","#FFEB3B","#FF5722","#607D8B","#E91E63","#3F51B5","#00BCD4","#8BC34A","#FFC107","#795548","#9C27B0","#2196F3","#009688","#CDDC39","#FF9800","#9E9E9E"],j=[["#E57373","#B71C1C"],["#673AB7","#7E57C2"],["#03A9F4","#039BE5"],["#4CAF50","#43A047"],["#FFEB3B","#F57F17"],["#FF5722","#D84315"],["#607D8B","#455A64"],["#E91E63","#C2185B"],["#3F51B5","#303F9F"],["#00BCD4","#0097A7"],["#8BC34A","#689F38"],["#FFC107","#FFA000"],["#795548","#5D4037"],["#9C27B0","#8E24AA"],["#2196F3","#1976D2"],["#009688","#00796B"],["#CDDC39","#AFB42B"],["#FF9800","#F57C00"],["#9E9E9E","#757575"]],k="rgba(0, 0, 0, 0)",l={},m=a.extend({colors:i,gradients:j,font:e,fontColor:f,fontSize:h,fill:r(b),imageOverlayColor:k},b);if(m.fill==c.fillTypeImage&&(m.fontStrokeColor||(m.fontStrokeColor=g),!m.images||!m.images.length)){var n="patterns",o=8,p=".png";m.images=[];for(var q=1;q<=o;q++)m.images.push(n+"/"+q+p)}c.drawProviders={},c.drawProviders[c.fillTypeColor]=y,c.drawProviders[c.fillTypeGradient]=z,c.drawProviders[c.fillTypeImage]=A,this.each(function(){var b=a(this);b.is("img")&&u(b[0])?b.on("error",v):w(b)})}}(jQuery);