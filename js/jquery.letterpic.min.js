!function(e){var t=function(){var e=this;e.colors=["#F44336","#673AB7","#03A9F4","#4CAF50","#FFEB3B","#FF5722","#607D8B","#E91E63","#3F51B5","#00BCD4","#8BC34A","#FFC107","#795548","#9C27B0","#2196F3","#009688","#CDDC39","#FF9800","#9E9E9E"],e.gradients=[["#E57373","#B71C1C"],["#673AB7","#7E57C2"],["#03A9F4","#039BE5"],["#4CAF50","#43A047"],["#FFEB3B","#F57F17"],["#FF5722","#D84315"],["#607D8B","#455A64"],["#E91E63","#C2185B"],["#3F51B5","#303F9F"],["#00BCD4","#0097A7"],["#8BC34A","#689F38"],["#FFC107","#FFA000"],["#795548","#5D4037"],["#9C27B0","#8E24AA"],["#2196F3","#1976D2"],["#009688","#00796B"],["#CDDC39","#AFB42B"],["#FF9800","#F57C00"],["#9E9E9E","#757575"]],e.font="Arial",e.fontColor="#fff",e.fontStrokeColor="#000",e.fontSize=.45,e.imageOverlayColor="rgba(0, 0, 0, 0)",e.maxInitialsLength=2,e.useGlobalCache=!0,e.images=[];for(var t="patterns",i=8,l=".png",r=1;i>=r;r++)e.images.push(t+"/"+r+l)},i=function(i){function l(e){if(e){var t=e.colors?self.fillTypeColor:e.gradients?self.fillTypeGradient:e.images?self.fillTypeImage:self.fillTypeGradient;return t}return self.fillTypeGradient}function r(e,t,i){function l(e,i){var l;return self.cache[e]||(self.cache[e]={}),self.cache[e][i]?l=self.cache[e][i]:(t.length||(colors=n.bgs.slice().reverse()),l=t.pop(),self.cache[e][i]=l),l}function r(e,t,i,l){var r=i*self.settings.fontSize;t.font=r+"px "+self.settings.font,t.textAlign="center";var n=i/2,a=.45*(r+l);self.settings.fontStrokeColor&&(t.shadowColor=self.settings.fontStrokeColor,t.shadowColor="black",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=3),t.fillStyle=self.settings.fontColor,t.fillText(e,n,a)}var n=this;n.bgs=t;var t=n.bgs.slice().reverse();n.draw=function(t,n,a){var s=l(e.fill,n),f=t[0],o=window.devicePixelRatio,c=o*t.width(),d=o*t.height(),h=f.getContext("2d");h.scale(o,o),t.attr("width",c),t.attr("height",d),i(h,f,s,function(){r(a,h,c,d)}),h.fillStyle=self.settings.imageOverlayColor,h.fillRect(0,0,f.width,f.height)}}self=this,self.fillTypeColor="color",self.fillTypeGradient="gradient",self.fillTypeImage="image";var n=new t;if(self.settings=e.extend(n,i),self.settings.fill=self.settings.fill||l(i),self.settings.useGlobalCache?(window.letterpicCache||(window.letterpicCache={}),self.cache=window.letterpicCache):self.cache={},self.settings.initial)for(var a in self.settings.initial){self.cache[a]||(self.cache[a]={});var s=self.settings.initial[a];for(var f in s)self.cache[a][f]=s[f]}self.drawProviders={},self.drawProviders[self.fillTypeColor]=function(e){return new r(e,e.colors,function(e,t,i,l){e.fillStyle=i,e.fillRect(0,0,t.width,t.height),l()})},self.drawProviders[self.fillTypeGradient]=function(e){return new r(e,e.gradients,function(e,t,i,l){var r=i,n=e.createLinearGradient(0,0,0,t.height);n.addColorStop(0,r[0]);for(var a=1/(r.length-1),s=1;s<r.length-1;s++)n.addColorStop(s*a,r[s]);n.addColorStop(1,r[r.length-1]),e.fillStyle=n,e.fillRect(0,0,t.width,t.height),l()})},self.drawProviders[self.fillTypeImage]=function(e){return new r(e,e.images,function(e,t,i,l){var r=new Image;r.onload=function(){e.drawImage(r,0,0,t.width,t.height),l()},r.src=i})},self.drawProvider=self.drawProviders[self.settings.fill](self.settings)};e.fn.letterpic=function(t){function l(e){var t=e.data().letterpicKey||e.data().letterpicUserId||e.data().userid||r(e);return t}function r(e){for(var t=e.attr("title"),i=t.split(" "),l=i[0].charAt(0).toUpperCase(),r=1;r<f.settings.maxInitialsLength;r++)i.length>r&&(l+=i[r].charAt(0).toUpperCase());return l}function n(e){return!e.complete||"undefined"!=typeof e.naturalWidth&&0===e.naturalWidth?!1:!0}function a(t){var i=e(t.target);i.off("error",a),s(i)}function s(t){var i;t.is("canvas")?i=t:(i=e("<canvas></canvas>"),e.each(t[0].attributes,function(e,t){i.attr(t.name,t.value)}),t.replaceWith(i));var n=l(i),a=r(i);f.drawProvider.draw(i,n,a)}var f=new i(t);this.each(function(){var t=e(this);t.is("img")&&n(t[0])?t.on("error",a):s(t)})}}(jQuery);